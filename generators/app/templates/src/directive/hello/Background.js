'use strict';
let config = require('./base.config');

function Background(cfg){
	for (var key in cfg){
		this[key]=cfg[key];
	}
	this.init();
}

Background.prototype={

	space : 10,

	data : null,

	exploded : false,

	init : function(){
		this.nodes=[];

		this.createNodes(t_2012,50,50,"#000");
		this.createNodes(t_BYE,500,50,"#ccc");
		this.createNodes(t_2013,50+70,50+250,"#339afe");
		this.createNodes(t_HI,500+70,50+250,"rgb(19,248,20)");

		this.fullNodes=[];

		//这里创建一个背景板，用来最终显示的
		this.img=document.createElement("canvas");
		this.img.width=canvas.width;
		this.img.height=canvas.height;
		var ctx=this.img.getContext("2d");
		for(var i = this.nodes.length - 1; i >= 0; i--) {
			var node = this.nodes[i];
			ctx.fillStyle = node.c;
			ctx.fillRect(node.x,node.y,9,9);
		}
		
	},

	show_new : function(context){
		context.globalAlpha=1;
		context.drawImage(this.img,0,0);
	},

	createNodes : function(text,ox,oy,oc){
		var Me=this;
		text.forEach(function(row,r){
			row.forEach(function(col,c){
				if (col===9){
					Me.nodes.push(
					{
						x : Me.space*c+ox,
						y : Me.space*r+oy,
						f : 0,
						c : oc
					}
					)
				}
			})
		})
	},

	update : function(dt){
		for (var i=this.nodes.length-1;i>=0;i--){
			var node=this.nodes[i];
			if (node.f){
				this.fullNodes.push(node);
				this.nodes.splice(i,1);
			}
		}
	},

	render : function(context){
		
		context.globalAlpha=0.13;
		context.fillStyle="#441166"
		context.fillRect(0,0,config.Config.width,config.Config.height);

		if (this.exploded){
			context.globalAlpha=0.13;
			context.drawImage(this.img,0,0);
		}

	}

}

var t_2012=[
[  , ,9,9,9,9,9, , , , , , ,9,9,9,9,9, , , , , , , ,9,9, , , , , , ,9,9, , ,  ],
[  ,9,9,9,9,9,9,9, , , , ,9,9,9,9,9,9,9, , , , , ,9,9,9, , , , , ,9,9, , , ,  ],
[ 9,9,9, , , ,9,9,9, , ,9,9,9, , , ,9,9,9, , , ,9,9,9,9, , , , ,9,9, , , , ,  ],
[ 9,9, , , , , ,9,9, , ,9,9, , , , , ,9,9, , ,9,9,9,9,9, , , ,9,9, , , , , ,  ],
[  , , , , , , ,9,9, , ,9,9, , , , , ,9,9, , , , , ,9,9, , ,9,9, , , , , , ,  ],
[  , , , , , ,9,9,9, , ,9,9, , , , , ,9,9, , , , , ,9,9, , ,9,9, , , , , , ,  ],
[  , , , , ,9,9,9, , , ,9,9, , , , , ,9,9, , , , , ,9,9, , ,9,9,9,9,9,9,9, ,  ],
[  , , , ,9,9,9, , , , ,9,9, , , , , ,9,9, , , , , ,9,9, , ,9,9,9,9,9,9,9,9,  ],
[  , , ,9,9,9, , , , , ,9,9, , , , , ,9,9, , , , , ,9,9, , ,9,9,9, , , ,9,9,9 ],
[  , ,9,9,9, , , , , , ,9,9, , , , , ,9,9, , , , , ,9,9, , ,9,9, , , , , ,9,9 ],
[  ,9,9,9, , , , , , , ,9,9, , , , , ,9,9, , , , , ,9,9, , ,9,9, , , , , ,9,9 ],
[ 9,9,9, , , , , , , , ,9,9,9, , , ,9,9,9, , , , , ,9,9, , ,9,9,9, , , ,9,9,9 ],
[ 9,9,9,9,9,9,9,9,9, , , ,9,9,9,9,9,9,9, , , , , , ,9,9, , ,9,9,9,9,9,9,9,9,  ],
[ 9,9,9,9,9,9,9,9,9, , , , ,9,9,9,9,9, , , , , , , ,9,9, , , ,9,9,9,9,9,9, ,  ],
];


var t_BYE=[
[ 9,9,9,9,9,9,9,9, , , , ,9,9, , , , , , , , ,9,9, , ,9,9,9,9,9,9,9,9,9,9 ],
[ 9,9,9,9,9,9,9,9,9, , , ,9,9,9, , , , , , ,9,9,9, , ,9,9,9,9,9,9,9,9,9,9 ],
[ 9,9, , , , , ,9,9,9, , , ,9,9,9, , , , ,9,9,9, , , ,9,9, , , , , , , ,  ],
[ 9,9, , , , , , ,9,9, , , , ,9,9,9, , ,9,9,9, , , , ,9,9, , , , , , , ,  ],
[ 9,9, , , , , , ,9,9, , , , , ,9,9,9,9,9,9, , , , , ,9,9, , , , , , , ,  ],
[ 9,9, , , , , ,9,9, , , , , , , ,9,9,9,9, , , , , , ,9,9, , , , , , , ,  ],
[ 9,9,9,9,9,9,9,9, , , , , , , , , ,9,9, , , , , , , ,9,9,9,9,9,9,9,9,9,  ],
[ 9,9,9,9,9,9,9,9,9, , , , , , , , ,9,9, , , , , , , ,9,9,9,9,9,9,9,9,9,  ],
[ 9,9, , , , , ,9,9,9, , , , , , , ,9,9, , , , , , , ,9,9, , , , , , , ,  ],
[ 9,9, , , , , , ,9,9, , , , , , , ,9,9, , , , , , , ,9,9, , , , , , , ,  ],
[ 9,9, , , , , , ,9,9, , , , , , , ,9,9, , , , , , , ,9,9, , , , , , , ,  ],
[ 9,9, , , , , ,9,9,9, , , , , , , ,9,9, , , , , , , ,9,9, , , , , , , ,  ],
[ 9,9,9,9,9,9,9,9,9, , , , , , , , ,9,9, , , , , , , ,9,9,9,9,9,9,9,9,9,9 ],
[ 9,9,9,9,9,9,9,9, , , , , , , , , ,9,9, , , , , , , ,9,9,9,9,9,9,9,9,9,9 ],
];

var t_2013=[
[  , ,9,9,9,9,9, , , , , , ,9,9,9,9,9, , , , , , , ,9,9, , ,9,9,9,9,9,9,9,9,  ],
[  ,9,9,9,9,9,9,9, , , , ,9,9,9,9,9,9,9, , , , , ,9,9,9, , ,9,9,9,9,9,9,9,9,  ],
[ 9,9,9, , , ,9,9,9, , ,9,9,9, , , ,9,9,9, , , ,9,9,9,9, , ,9,9, , , , ,9,9,  ],
[ 9,9, , , , , ,9,9, , ,9,9, , , , , ,9,9, , ,9,9,9,9,9, , ,9,9, , , , ,9,9,  ],
[  , , , , , , ,9,9, , ,9,9, , , , , ,9,9, , , , , ,9,9, , , , , , , , ,9,9,  ],
[  , , , , , ,9,9,9, , ,9,9, , , , , ,9,9, , , , , ,9,9, , , , , , , , ,9,9,  ],
[  , , , , ,9,9,9, , , ,9,9, , , , , ,9,9, , , , , ,9,9, , , , , , , , ,9,9,  ],
[  , , , ,9,9,9, , , , ,9,9, , , , , ,9,9, , , , , ,9,9, , , , , , , , ,9,9,  ],
[  , , ,9,9,9, , , , , ,9,9, , , , , ,9,9, , , , , ,9,9, , , , , , , , ,9,9,  ],
[  , ,9,9,9, , , , , , ,9,9, , , , , ,9,9, , , , , ,9,9, , , , , , , , ,9,9,  ],
[  ,9,9,9, , , , , , , ,9,9, , , , , ,9,9, , , , , ,9,9, , , , , , , , ,9,9,  ],
[ 9,9,9, , , , , , , , ,9,9,9, , , ,9,9,9, , , , , ,9,9, , , , , , , , ,9,9,  ],
[ 9,9,9,9,9,9,9,9,9, , , ,9,9,9,9,9,9,9, , , , , , ,9,9, , , , , , , , ,9,9,  ],
[ 9,9,9,9,9,9,9,9,9, , , , ,9,9,9,9,9, , , , , , , ,9,9, , , , , , , , ,9,9,  ],
];


var t_HI=[
[ 9,9, , , , , , ,9,9, , ,9,9,9,9,9,9 ],
[ 9,9, , , , , , ,9,9, , ,9,9,9,9,9,9 ],
[ 9,9, , , , , , ,9,9, , , , ,9,9, ,  ],
[ 9,9, , , , , , ,9,9, , , , ,9,9, ,  ],
[ 9,9, , , , , , ,9,9, , , , ,9,9, ,  ],
[ 9,9, , , , , , ,9,9, , , , ,9,9, ,  ],
[ 9,9,9,9,9,9,9,9,9,9, , , , ,9,9, ,  ],
[ 9,9,9,9,9,9,9,9,9,9, , , , ,9,9, ,  ],
[ 9,9, , , , , , ,9,9, , , , ,9,9, ,  ],
[ 9,9, , , , , , ,9,9, , , , ,9,9, ,  ],
[ 9,9, , , , , , ,9,9, , , , ,9,9, ,  ],
[ 9,9, , , , , , ,9,9, , , , ,9,9, ,  ],
[ 9,9, , , , , , ,9,9, , ,9,9,9,9,9,9 ],
[ 9,9, , , , , , ,9,9, , ,9,9,9,9,9,9 ],
];

module.exports = Background;